#!/usr/bin/env bash
# shellcheck source-path=SCRIPTDIR

ROOT=$(dirname "$(dirname "$(realpath "${BASH_SOURCE[0]}")")")
# shellcheck source=setup
source "$ROOT/bin/setup"
SPYTHON=/opt/venv/bin/spython

rm -f container.def
{
  echo "# This file is auto-generated by bin/generate-container-def"
  echo "# DO NOT EDIT"
  echo ""
} >> container.def
${RUN} ${SPYTHON} recipe .devcontainer/Dockerfile | \
  grep -v SHELL | \
  sed 's!%post!%post -c /bin/bash!g' | \
  sed '/%runscript/,$d' | \
  sed 's/\r$//g' \
  >> container.def
  # grep -V SHELL >> container.def
chmod 444 container.def
