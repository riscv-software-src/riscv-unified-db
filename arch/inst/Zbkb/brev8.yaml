# yaml-language-server: $schema=../../../schemas/inst_schema.json

$schema: inst_schema.json#
kind: instruction
name: brev8
long_name: Reverse the bits in each byte of a source register.
description: |
  This instruction reverses the order of the bits in every byte of a register. 
definedBy:
  anyOf: [B, Zbkb, Zk, Zkn, Zks]
assembly: xd, xs1
encoding:
  match: 011010000111-----101-----0010011
  variables:
    - name: rs1
      location: 19-15
    - name: rd
      location: 11-7
access:
  s: always
  u: always
  vs: always
  vu: always
data_independent_timing: false
operation(): |
  if (implemented?(ExtensionName::B) && (CSR[misa].Zbkb == 1'b0)) {
    raise (ExceptionCode::IllegalInstruction, mode(), $encoding);
  }

  result : xlenbits = EXTZ(0b0);
  foreach (i from 0 to sizeof(xlen) by 8) {
    result[i+7..i] = reverse_bits_in_byte(X(rs1)[i+7..i]);
  };
  X(rd) = result;
